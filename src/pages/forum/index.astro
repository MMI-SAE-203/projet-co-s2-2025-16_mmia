---
import Layout from "../../layouts/Layout.astro";
import CardPost from "../../components/Card_post.astro";
import { getPosts } from "../../../backend/backend.mjs";
import { requireAuth, getCurrentUser } from "../../../script/auth"; 

//const authCheck = await requireAuth(Astro);
//if (authCheck) return authCheck;
//const user = await getCurrentUser();

const {id} = Astro.params;

let message ='';
let posts = [];

posts = await getPosts() || [];

if (!posts){
	return Astro.redirect ('/posts');
}
console.log(posts)
---

<Layout titre=Forum>
    
    <div class="relative block">
        <span class="absolute inset-x-0 bottom-0 h-2 bg-[-var(--violet)] z-0"></span>
        <h1 class="text-4xl font-bold text-center my-12">Forum</h1>
    </div>
    <div class="">
        <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-3 gap-4 mt-12">
            {posts.map((post:any) => <CardPost {...post} />)}
        </div> 
    </div>
</Layout>